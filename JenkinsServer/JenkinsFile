pipeline {
   agent any   

   environment {
        JENKINS_HOME = 'D:/Jenkins'
        DELAY_TIME = '0.2'
    }

   stages {
    stage('Build') {
        steps {
            // // This command is done implicitely by the config on the Jenkins
            // checkout([$class: 'GitSCM', branches: [[name: '*/master']],
            //     userRemoteConfigs: [[url: 'https://github.com/PabloBelmonte/AutoPlant.git']]])
            info('Build')
            script {
                def readSensorData = readJSON file: "./uC_interface/sensor.json"
                bat "echo $readSensorData['glossary']"
                readSensorData.each { key, value ->
                    echo "Walked through key $key and value $value"
                }
            }
        }
        

        //  post {
        //     // If Maven was able to run the tests, even if some of the test
        //     // failed, record the test results and archive the jar file.
        //     success {
        //        junit '**/target/surefire-reports/TEST-*.xml'
        //        archiveArtifacts 'target/*.jar'
        //     }
        //  }
    }
    stage('Run Pump') {
        steps {
            // info('Run Pump')
            runPython('uC_interface/run_pump.py')
        }

    }

    stage('Get Sensor Data') {
        steps {
            runPython('uC_interface/get_sensor_data.py')
            // script {
            //     bat "echo $readSensorData.temperature.name"
            // }
            
             
            // info('$TEMPERATURE')
            // info($PH)
        }
    }

    // stage('Show Sensor data') {
    //     steps {
    //         info('Show Sensor data')
    //     }
    // }

   }
}

def runPython(name) {
    script {
    if (isUnix()) {
            sh "python $WORKSPACE/$name"
        } else {
            bat "python $WORKSPACE/$name"
        }
    }
}

def info(message) {
    echo "INFO: ${message}"
}

def warning(message) {
    echo "WARNING: ${message}"
}

def error(message) {
    echo "ERROR: ${message}"
}